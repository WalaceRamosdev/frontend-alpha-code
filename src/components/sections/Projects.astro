---
import { projectsData } from '../../data/projects';
import Card from '../ui/Card.astro';
import Button from '../ui/Button.astro';

// Limit to 3 for home page
const displayedProjects = projectsData.slice(0, 3);
---

<section id="projects">
    <div class="container">
        <div class="section-header">
            <h2 class="fade-up-projects">Projetos que Geram <br><span class="text-primary">RESULTADO</span></h2>
            <p class="fade-up-projects delay-1 section-desc">
                Não vendemos apenas design bonito. Entregamos ferramentas de performance 
                que aumentam sua autoridade e suas vendas.
            </p>
        </div>
        <div class="projects-grid">
            {displayedProjects.map((project, index) => (
                <Card variant="project" class="project-card-anim">
                    <a href={project.link} target="_blank" rel="noopener noreferrer" class="project-card-link">
                        <div class="project-image">
                            <!-- Ideally use <Image /> here if image paths are resolute, 
                                 but for public folder images, normal img tag is fine or Image with width/height explicitly.
                                 Since SVG, img tag is better. -->
                            <img src={project.image} alt={`Site ${project.type} - ${project.name}`} loading="lazy" />
                        </div>
                        <div class="project-info">
                            <span class="project-type">{project.type}</span>
                            <h3>{project.name}</h3>
                            <span class="project-link">Ver Site <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></span>
                        </div>
                    </a>
                </Card>
            ))}
        </div>
        <div class="see-more-container fade-up-projects delay-2">
            <div class="scroll-hint-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevrons-right"><polyline points="13 17 18 12 13 7"></polyline><polyline points="6 17 11 12 6 7"></polyline></svg>
                <span>Deslize</span>
            </div>
            <Button href="/projects" variant="primary" size="lg">Quero um Site como esses</Button>
            <a href="/projects" class="text-link mt-2">Ver Portfólio Completo →</a>
        </div>
    </div>
</section>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    gsap.registerPlugin(ScrollTrigger);

    document.addEventListener("DOMContentLoaded", () => {
        const section = document.getElementById("projects");
        
        if (section) {
            gsap.from(".fade-up-projects", {
                scrollTrigger: {
                    trigger: ".section-header",
                    start: "top 80%",
                },
                y: 40,
                opacity: 0,
                duration: 0.8,
                stagger: 0.2,
                ease: "power2.out"
            });

            gsap.from(".project-card-anim", {
                scrollTrigger: {
                    trigger: ".projects-grid",
                    start: "top 75%",
                },
                y: 60,
                opacity: 0,
                duration: 0.8,
                stagger: 0.2,
                ease: "power2.out"
            });
        }
    });
</script>

<style>
#projects {
    padding: 100px 0;
    background-color: var(--color-bg-alt);
    overflow: hidden; /* Prevent horizontal scroll on page */
}

.section-desc {
    max-width: 600px;
    margin: 1rem auto 3rem;
    color: var(--color-text-secondary);
    text-align: center;
}

.projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin-top: 40px;
    padding: 10px; /* Prevent shadow clipping */
}

.section-header {
    text-align: center;
    margin-bottom: 3rem;
}

/* Basic styles for card content */
.project-image {
    width: 100%;
    height: 220px; /* Slightly taller for better view */
    background-color: #ddd;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
    border-bottom: 1px solid var(--border-light);
}

.project-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.project-card-link:hover .project-image img {
    transform: scale(1.08); /* Smoother zoom */
}

.project-info {
    padding: 24px;
    background: var(--color-bg-surface);
}

.project-type {
    display: block;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 700;
    color: var(--color-primary);
    margin-bottom: 8px;
}

.project-info h3 {
    margin-bottom: 12px;
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-heading);
}

.project-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--color-text-main);
    transition: color 0.2s;
}

.project-link:hover {
    color: var(--color-primary);
}

.see-more-container {
    text-align: center;
    margin-top: 50px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
}
.text-link {
    color: var(--color-text-muted);
    font-size: 0.9rem;
    text-decoration: none;
    transition: color 0.2s;
}
.text-link:hover {
    color: var(--color-primary);
}

/* Scroll Hint - Default Hidden on Desktop */
.scroll-hint-icon {
    display: none;
    align-items: center;
    gap: 6px;
    font-size: 0.85rem;
    color: var(--color-text-light);
    opacity: 0.8;
    animation: bounceRight 2s infinite ease-in-out;
    margin-bottom: 10px;
}

@keyframes bounceRight {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(6px); }
}

/* TABLET AND MOBILE: CAROUSEL MODE */
@media (max-width: 1024px) {
    .projects-grid {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        gap: 20px;
        padding: 20px 5px 30px 5px; /* Bottom padding for scrollbar/shadow */
        margin-top: 20px;
        
        /* Hide scrollbar for cleaner look */
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none;  /* IE 10+ */
    }
    
    .projects-grid::-webkit-scrollbar {
        display: none; /* Chrome/Safari */
    }

    /* Force cards to be carousel items */
    .projects-grid > :global(*) {
        flex: 0 0 85%; /* Show snippet of next card */
        max-width: 85%;
        scroll-snap-align: center;
        min-width: 280px;
    }

    /* Show scroll hint only on these devices */
    .scroll-hint-icon {
        display: flex;
    }
}

@media (min-width: 1025px) {
    .projects-grid {
        justify-content: center; /* Center grid items on desktop if fewer than columns */
    }
}
</style>
