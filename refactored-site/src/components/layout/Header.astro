---
import Button from '../ui/Button.astro';
---

<header id="main-header">
    <div class="container header-container">
        <a href="/" class="logo-link">
            <!-- Inline SVG for Theme Adaptability -->
            <img src="/assets/logoText.svg" alt="Alpha Code Logo" class="nav-logo" width="150" height="50">
        </a>
        <nav class="desktop-nav">
            <ul>
                <li><a href="/#services">Serviços</a></li>
                <li><a href="/#projects">Projetos</a></li>
                <!-- <li><a href="#audience">Para Quem</a></li> -->
                <li><a href="/#testimonials">Depoimentos</a></li>
                <!-- Flat Links -->
                <li><a href="/planos">Planos</a></li>
                <li><a href="/pedido?plan=manutencao">Manutenção de Página</a></li>
                <li><a href="/about">Sobre</a></li>
            </ul>
        </nav>
        <div class="header-actions">
            <!-- Custom Theme Switch -->
            <div class="theme-switch-wrapper">
                <label class="theme-switch" for="checkbox-theme">
                    <input type="checkbox" id="checkbox-theme" aria-label="Alternar Tema">
                    <span class="slider round">
                        <span class="label-light">MODO<br>CLARO</span>
                        <span class="label-dark">MODO<br>ESCURO</span>
                        <div class="thumb">
                            <span class="icon-sun">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#FDB813" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                            </span>
                            <span class="icon-moon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#6E0F18" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                            </span>
                        </div>
                    </span>
                </label>
            </div>
            <!-- Removed Desktop WhatsApp Button as per request -->
            <button id="mobile-menu-btn" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </div>
    <!-- Mobile Menu -->
    <div class="mobile-menu">
        <ul>
            <li><a href="/#services">Serviços</a></li>
            <li><a href="/#projects">Projetos</a></li>
            <li><a href="/#testimonials">Depoimentos</a></li>
            <li><a href="/#audience">Para Quem</a></li>
            <li><a href="/planos">Planos</a></li>
            <li><a href="/pedido?plan=manutencao">Manutenção de Página</a></li>
            <li><a href="/about">Sobre</a></li>
            <li><a href="https://wa.me/5521999064502" class="btn btn-primary">Falar no WhatsApp</a></li>
        </ul>
    </div>
</header>

<script>
    // Theme Switcher Logic
    const themeCheckbox = document.getElementById('checkbox-theme');
    const htmlElement = document.documentElement;

    function updateLogo(isDark) {
        const logoImg = document.querySelector('.nav-logo');
        if (logoImg) {
            if (isDark) {
                logoImg.src = '/assets/logoText.svg'; // Default White/Gold Logo
            } else {
                logoImg.src = '/assets/logoTemaDark.svg'; // Dark Theme Logo for Light Background
            }
        }
    }

    // Check local storage or preference
    const savedTheme = localStorage.getItem('theme');
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

    if (savedTheme === 'dark') {
        htmlElement.setAttribute('data-theme', 'dark');
        if (themeCheckbox && themeCheckbox instanceof HTMLInputElement) themeCheckbox.checked = true;
        updateLogo(true);
    } else {
        htmlElement.setAttribute('data-theme', 'light');
        if (themeCheckbox && themeCheckbox instanceof HTMLInputElement) themeCheckbox.checked = false;
        updateLogo(false);
    }

    if (themeCheckbox) {
        themeCheckbox.addEventListener('change', () => {
             const checkbox = themeCheckbox as HTMLInputElement;
            if (checkbox.checked) {
                htmlElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                updateLogo(true);
            } else {
                htmlElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
                updateLogo(false);
            }
        });
    }

    // Mobile Menu Logic
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.querySelector('.mobile-menu');
    const mobileLinks = document.querySelectorAll('.mobile-menu a');

    if (mobileMenuBtn && mobileMenu) {
        mobileMenuBtn.addEventListener('click', () => {
            const isOpen = mobileMenu.classList.contains('open');
            if (isOpen) {
                mobileMenu.classList.remove('open');
            } else {
                mobileMenu.classList.add('open');
            }
        });

        mobileLinks.forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.remove('open');
            });
        });

        document.addEventListener('click', (e) => {
            if (!mobileMenu.contains(e.target) && !mobileMenuBtn.contains(e.target) && mobileMenu.classList.contains('open')) {
                mobileMenu.classList.remove('open');
            }
        });
    }
</script>

<style>
/* Header Styles */
#main-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background-color: var(--color-bg-header);
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    z-index: 1000;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);
    padding: 12px 0;
    transition: background-color var(--transition-speed), padding var(--transition-speed);
}
[data-theme="dark"] #main-header {
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
}
.header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.logo-link {
    text-decoration: none;
    display: flex;
    align-items: center;
    transition: opacity var(--transition-speed);
}
.logo-link:hover {
    opacity: 0.8;
}
.nav-logo {
    height: 50px;
    width: auto;
    display: block;
}

/* Nav */
.desktop-nav ul {
    display: flex;
    gap: 8px;
    align-items: center;
}
.desktop-nav a {
    position: relative;
    font-weight: 600;
    font-size: 0.95rem;
    padding: 10px 18px;
    border-radius: 30px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    color: var(--color-text-main);
}
.desktop-nav a:hover {
    background-color: rgba(223, 55, 97, 0.08);
    color: var(--color-primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(110, 15, 24, 0.15);
}
[data-theme="dark"] .desktop-nav a:hover {
    background-color: rgba(255, 255, 255, 0.1);
    color: #FFFFFF;
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.15);
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 15px;
}

/* Theme Switch */
.theme-switch-wrapper {
    display: flex;
    align-items: center;
}
.theme-switch {
    position: relative;
    display: inline-block;
    width: 84px;
    height: 31px;
}
.theme-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}
.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #E0E0E0;
    transition: 0.4s;
    border-radius: 34px;
    box-shadow: inset 2px 2px 5px rgba(0, 0, 0, 0.1), inset -2px -2px 5px rgba(255, 255, 255, 0.8);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 10px;
    overflow: hidden;
}
[data-theme="dark"] .slider {
    background-color: #2C2C2C;
    box-shadow: inset 3px 3px 6px rgba(0, 0, 0, 0.5), inset -2px -2px 5px rgba(255, 255, 255, 0.05);
}
.thumb {
    position: absolute;
    height: 25px;
    width: 25px;
    right: 3px;
    bottom: 3px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2;
}
input:checked + .slider .thumb {
    transform: translateX(-53px);
    background-color: #1a1a1a;
}
.label-light, .label-dark {
    font-size: 0.5rem;
    font-weight: 800;
    line-height: 1;
    color: #888;
    text-align: center;
    position: absolute;
    transition: opacity 0.3s;
    pointer-events: none;
    z-index: 1;
}
.label-light { left: 14px; opacity: 1; }
.label-dark { right: 14px; opacity: 0; }
input:checked + .slider .label-light { opacity: 0; }
input:checked + .slider .label-dark { opacity: 1; color: var(--color-primary); }
.icon-sun, .icon-moon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%); /* Perfect centering */
    transition: opacity 0.3s;
    line-height: 0;
    display: flex;
}
.icon-sun { opacity: 1; }
.icon-moon { opacity: 0; }
input:checked + .slider .icon-sun { opacity: 0; }
input:checked + .slider .icon-moon { opacity: 1; }

/* Mobile Menu */
#mobile-menu-btn {
    display: none;
    background: none;
    border: none;
    cursor: pointer;
    flex-direction: column;
    gap: 5px;
    width: 30px;
}
#mobile-menu-btn span {
    display: block;
    width: 100%;
    height: 3px;
    background-color: var(--color-primary);
    transition: 0.3s;
}
.mobile-menu {
    position: fixed;
    top: 70px;
    left: 0;
    width: 100%;
    background-color: var(--color-bg-surface);
    padding: 20px;
    border-bottom: 2px solid var(--color-primary);
    transform: translateY(-150%);
    transition: transform 0.4s ease-in-out;
    z-index: 999;
    text-align: center;
}
.mobile-menu.open {
    transform: translateY(0);
    box-shadow: var(--shadow-medium);
}
.mobile-menu ul {
    display: flex;
    flex-direction: column;
    gap: 20px;
    align-items: center; /* Center items including the button */
}
.mobile-menu .btn { 
    width: auto; 
    min-width: 200px; /* Decent minimum clickable size */
    margin: 0 auto;
}

@media (max-width: 768px) {
    .desktop-nav { display: none; }
    #mobile-menu-btn { display: flex; }
}
</style>
